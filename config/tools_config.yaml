# Tool Security Gateway — Parametric Whitelist Configuration
# Each entry defines a whitelisted command template with regex-validated parameters.
# Commands use Windows CLI (cmd.exe / PowerShell) syntax.

cli_whitelist:
  list_files:
    description: "List files and directories"
    template: "dir /A /O:N {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  read_file:
    description: "Read file contents"
    template: "type {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  search_text:
    description: "Search for text patterns in files"
    template: "findstr /S /N /R {pattern} {path}"
    params:
      pattern: "^[a-zA-Z0-9_.* -]+$"
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 30

  make_directory:
    description: "Create a directory (including parents)"
    template: "mkdir {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  tree:
    description: "Show directory tree"
    template: "tree /F {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]*$"
    timeout: 10

  head_file:
    description: "Show first N lines of a file"
    template: "powershell -Command \"Get-Content {path} -TotalCount {lines}\""
    params:
      lines: "^[0-9]+$"
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  tail_file:
    description: "Show last N lines of a file"
    template: "powershell -Command \"Get-Content {path} -Tail {lines}\""
    params:
      lines: "^[0-9]+$"
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  word_count:
    description: "Count lines, words, characters in a file"
    template: "powershell -Command \"Get-Content {path} | Measure-Object -Line -Word -Character\""
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  write_json:
    description: "Write content to a .json file"
    template: "powershell -Command \"Set-Content -Path {path} -Value {content}\""
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+\\.json$"
      content: "^[\\s\\S]+$"
    timeout: 15

  write_txt:
    description: "Write content to a .txt file"
    template: "powershell -Command \"Set-Content -Path {path} -Value {content}\""
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+\\.txt$"
      content: "^[\\s\\S]+$"
    timeout: 15

  write_md:
    description: "Write content to a .md file"
    template: "powershell -Command \"Set-Content -Path {path} -Value {content}\""
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+\\.md$"
      content: "^[\\s\\S]+$"
    timeout: 15

  copy_file:
    description: "Copy a file from source to destination"
    template: "copy {src} {dst}"
    params:
      src: "^[a-zA-Z0-9_.\\\\-]+$"
      dst: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  move_file:
    description: "Move or rename a file"
    template: "move {src} {dst}"
    params:
      src: "^[a-zA-Z0-9_.\\\\-]+$"
      dst: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  python_run:
    description: "Run a Python script from the scripts\\ directory"
    template: "python {script}"
    params:
      script: "^scripts\\\\[a-zA-Z0-9_\\\\-]+\\.py$"
    timeout: 120

# Blocked patterns — commands that must NEVER be executed
blocked_patterns:
  - "rm\\s+-rf"
  - "rm\\s+-r"
  - "rmdir\\s+/s"
  - "del\\s+/f"
  - "del\\s+/s"
  - "format\\s+[a-zA-Z]:"
  - "mkfs"
  - "dd\\s+if="
  - "chmod\\s+777"
  - "curl.*\\|.*sh"
  - "wget.*\\|.*sh"
  - "eval\\("
  - "__import__"
  - "os\\.system"
  - "subprocess"
  - "Remove-Item.*-Recurse"
