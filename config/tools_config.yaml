# Tool Security Gateway — Parametric Whitelist Configuration
# Each entry defines a whitelisted command template with regex-validated parameters.

cli_whitelist:
  list_files:
    description: "List files and directories"
    template: "ls -la {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  read_file:
    description: "Read file contents"
    template: "cat {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  search_text:
    description: "Search for text patterns in files"
    template: "grep -rn {pattern} {path}"
    params:
      pattern: "^[a-zA-Z0-9_.* -]+$"
      path: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 30

  make_directory:
    description: "Create a directory (including parents)"
    template: "mkdir -p {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  tree:
    description: "Show directory tree"
    template: "find {path} -type f"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]*$"
    timeout: 10

  head_file:
    description: "Show first N lines of a file"
    template: "head -n {lines} {path}"
    params:
      lines: "^[0-9]+$"
      path: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  tail_file:
    description: "Show last N lines of a file"
    template: "tail -n {lines} {path}"
    params:
      lines: "^[0-9]+$"
      path: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  word_count:
    description: "Count lines, words, characters in a file"
    template: "wc {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  write_json:
    description: "Write content to a .json file in the ects_skill/tmp/ directory"
    template: "python -c \"import sys,pathlib; pathlib.Path({path}).write_text(sys.stdin.read())\" <<< {content}"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]+\\.json$"
      content: "^[\\s\\S]+$"
    timeout: 15

  write_txt:
    description: "Write content to a .txt file in the ects_skill/tmp/ directory"
    template: "python -c \"import sys,pathlib; pathlib.Path({path}).write_text(sys.stdin.read())\" <<< {content}"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]+\\.txt$"
      content: "^[\\s\\S]+$"
    timeout: 15

  write_md:
    description: "Write content to a .md file in the ects_skill/tmp/ directory"
    template: "python -c \"import sys,pathlib; pathlib.Path({path}).write_text(sys.stdin.read())\" <<< {content}"
    params:
      path: "^[a-zA-Z0-9_.\\\\/-]+\\.md$"
      content: "^[\\s\\S]+$"
    timeout: 15

  copy_file:
    description: "Copy a file from source to destination"
    template: "cp {src} {dst}"
    params:
      src: "^[a-zA-Z0-9_.\\\\/-]+$"
      dst: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  move_file:
    description: "Move or rename a file"
    template: "mv {src} {dst}"
    params:
      src: "^[a-zA-Z0-9_.\\\\/-]+$"
      dst: "^[a-zA-Z0-9_.\\\\/-]+$"
    timeout: 10

  python_run:
    description: "Run a Python script from the scripts/ directory"
    template: "python {script}"
    params:
      script: "^scripts[/\\\\][a-zA-Z0-9_/\\\\-]+\\.py$"
    timeout: 120

# Blocked patterns — commands that must NEVER be executed
blocked_patterns:
  - "rm\\s+-rf"
  - "rm\\s+-r"
  - "rmdir\\s+/s"
  - "del\\s+/f"
  - "del\\s+/s"
  - "format\\s+[a-zA-Z]:"
  - "mkfs"
  - "dd\\s+if="
  - "chmod\\s+777"
  - "curl.*\\|.*sh"
  - "wget.*\\|.*sh"
  - "eval\\("
  - "__import__"
  - "os\\.system"
  - "subprocess"
  - "Remove-Item.*-Recurse"
