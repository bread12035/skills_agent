# Tool Security Gateway — Parametric Whitelist Configuration
# Each entry defines a whitelisted command template with regex-validated parameters.
# Commands use Windows CLI (cmd.exe / PowerShell) syntax.
#
# DESIGN PRINCIPLE: Only expose tools for I/O operations (read/write/run).
# Text analysis tasks (searching, extracting, counting, summarizing) are handled
# by the LLM's native reasoning — NOT by CLI tools. This prevents the agent from
# drifting into tool-chaining for tasks it should solve with text comprehension.

cli_whitelist:
  list_files:
    description: "List files and directories"
    template: "dir /A /O:N {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  read_file:
    description: "Read file contents"
    template: "type {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  make_directory:
    description: "Create a directory (including parents)"
    template: "mkdir {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  tree:
    description: "Show directory tree"
    template: "tree /F {path}"
    params:
      path: "^[a-zA-Z0-9_.\\\\-]*$"
    timeout: 10

  write_json:
    description: "Write content to a .json file"
    template: "powershell -Command \"Set-Content -Path {path} -Value '{content}'\""
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+\\.json$"
      content: "^[\\s\\S]+$"
    timeout: 15

  write_txt:
    description: "Write content to a .txt file"
    template: "powershell -Command \"Set-Content -Path {path} -Value {content}\""
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+\\.txt$"
      content: "^[\\s\\S]+$"
    timeout: 15

  write_md:
    description: "Write content to a .md file"
    template: "powershell -Command \"Set-Content -Path {path} -Value {content}\""
    params:
      path: "^[a-zA-Z0-9_.\\\\-]+\\.md$"
      content: "^[\\s\\S]+$"
    timeout: 15

  copy_file:
    description: "Copy a file from source to destination"
    template: "copy {src} {dst}"
    params:
      src: "^[a-zA-Z0-9_.\\\\-]+$"
      dst: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  move_file:
    description: "Move or rename a file"
    template: "move {src} {dst}"
    params:
      src: "^[a-zA-Z0-9_.\\\\-]+$"
      dst: "^[a-zA-Z0-9_.\\\\-]+$"
    timeout: 10

  python_run:
    description: "Run a Python script from scripts\\ or skills\\<skill>\\ directory"
    template: "python {script}"
    params:
      script: "^(scripts|skills)\\\\[a-zA-Z0-9_\\\\-]+(\\\\.py|\\\\[a-zA-Z0-9_\\\\-]+\\.py)$"
    timeout: 120

# --- REMOVED CLI TOOLS (replaced by LLM native reasoning) ---
# The following tools were removed because they overlap with the LLM's text
# processing capabilities and encourage tool-chaining instead of reasoning:
#
# - search_text (findstr): LLM should read the full file and search within context
# - head_file (Get-Content -TotalCount): LLM should read_file and process the beginning
# - tail_file (Get-Content -Tail): LLM should read_file and process the end
# - word_count (Measure-Object): LLM should read_file and count/estimate in reasoning

# Blocked patterns — commands that must NEVER be executed
blocked_patterns:
  - "rm\\s+-rf"
  - "rm\\s+-r"
  - "rmdir\\s+/s"
  - "del\\s+/f"
  - "del\\s+/s"
  - "format\\s+[a-zA-Z]:"
  - "mkfs"
  - "dd\\s+if="
  - "chmod\\s+777"
  - "curl.*\\|.*sh"
  - "wget.*\\|.*sh"
  - "eval\\("
  - "__import__"
  - "os\\.system"
  - "subprocess"
  - "Remove-Item.*-Recurse"
